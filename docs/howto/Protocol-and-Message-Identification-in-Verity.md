## Protocol and Message Identification in Verity

Protocol and message identification follow conventions specified by the
[Hyperledger Aries Project](https://github.com/hyperledger/aries). Specifically, the conventions defined in
[Aries RFC 0008: Message ID and Threading](https://github.com/hyperledger/aries-rfcs/blob/master/concepts/0008-message-id-and-threading/README.md)

In short:

API parameters:
- `Thread ID` identifies a protocol interaction. The same `Thread ID` identifier is used for each message of a given interaction. This identifier allows API users to re-enter an already existing protocol. Additionally, this identifier allows API users to differentiate protocol instances that are running in parallel. Each interaction needs to have and be given a unique `Thread ID`. This identifier should be persisted and managed by the API user. This parameter is presented as `threadId` in `Java` and as `thread_id` in `Python` and `NodeJs`.


Message Fields:
- `@id` field uniquely identifies each individual message. This identifier is generated by the message sender. 
- `~thread` is a decorator block that identifies the thread that a given message is part of.
- `thid` field is part of the `~thread` block in the message, and it references the `Thread ID` to which this message belongs.
- `pthid` field is an optional field in the `~thread` block, and it specifies the parent thread id of the message. This can be used in nested interactions to signals to the other party that this is a topic that is branching off of an existing interaction.

> NOTE: Both `@id` and `threadId` values should have no meaning to the recipient of the message (opaque identifiers). It is recommended to use **uuid** to generate these values

Here are our guidelines regarding usage of these fields in both Verity SDK and Verity REST API:

For the Verity SDK:
- You never need to specify the `@id` field for your messages. Verity SDK transparently generates **uuid** value for this field in the background.
- `Thread ID` does not need to be generated. When constructing a new interaction in the SDK, the `threadId` should be ignored during construction. Verity SDK will generate a new **uuid** for the `Thread ID` transparently. The `Thread ID` can be accessed for all constructed protocol objects.
- You should store the `Thread Id` by accessing it by the `Thread ID` getter (ex. for java `getThreadId`) that is available for all constructed protocol objects.

For the Verity REST API:
- You MUST specify the `@id` field in the body of your REST API call. This field must be unique for each message.
- You MUST specify a unique `Thread ID` in the URL when starting a new protocol interaction. This `Thread ID` should be persisted for future API calls.

